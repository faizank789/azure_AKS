module "aks" {
  source                               = "../../../../modules/aks"  
  location                             = data.terraform_remote_state.network.outputs.resource_group_location[0]
  resource_group_name                  = data.terraform_remote_state.network.outputs.resource_group_name[0]
  cluster_name                         = var.cluster_name
  cluster_log_analytics_workspace_name = var.cluster_log_analytics_workspace_name
  prefix                               = var.prefix
  admin_username                       = var.admin_username
  agents_size                          = var.agents_size
  log_analytics_workspace_sku          = var.log_analytics_workspace_sku
  log_retention_in_days                = var.log_retention_in_days
  agents_count                         = var.agents_count
  tags                                 = var.tags
  os_disk_size_gb                      = var.os_disk_size_gb
  sku_tier                             = var.sku_tier
  enable_role_based_access_control     = var.enable_role_based_access_control
  rbac_aad_managed                     = var.rbac_aad_managed
  enable_auto_scaling                  = var.enable_auto_scaling
  network_policy                       = var.network_policy
  network_plugin                       = var.network_plugin
  net_profile_dns_service_ip           = var.net_profile_dns_service_ip
  net_profile_docker_bridge_cidr       = var.net_profile_docker_bridge_cidr
  net_profile_outbound_type            = var.net_profile_outbound_type
  net_profile_pod_cidr                 = var.net_profile_pod_cidr
  net_profile_service_cidr             = var.net_profile_service_cidr
  kubernetes_version                   = var.kubernetes_version
  orchestrator_version                 = var.orchestrator_version
  agents_max_count                     = var.agents_max_count
  agents_min_count                     = var.agents_min_count
  agents_pool_name                     = var.agents_pool_name
  agents_availability_zones            = var.agents_availability_zones
  agents_labels                        = var.agents_labels
  agents_type                          = var.agents_type
  agents_tags                          = var.agents_tags
  agents_max_pods                      = var.agents_max_pods
  identity_type                        = var.identity_type
  vnet_subnet_id                       = data.terraform_remote_state.network.outputs.subnet_id[0][4]
  private_cluster_enabled              = var.private_cluster_enabled
  key_data = file("/bp/workspace/devops-iac/env/prod/key/azure-prod.pub")
  # key_data = file("/home/opstree/Documents/ApnaMart/azure/keys/prod/azure-prod.pub")
  enable_ingress_application_gateway   =  null
  ingress_application_gateway_name     = var.ingress_application_gateway_name
  ingress_application_gateway_subnet_cidr  = var.ingress_application_gateway_subnet_cidr
  additional_node_pools                = var.additional_node_pools
  client_id                            = var.client_id
  client_secret                        = var.client_secret

}
